name: Deploy Notify

on:
  push:
    branches: [main]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 2

      - name: Notify Discord
        run: |
          COMMIT_MSG=$(git log -1 --pretty=%s)
          AUTHOR=$(git log -1 --pretty=%an)
          HASH=$(git log -1 --pretty=%h)
          FILES=$(git diff --name-only HEAD~1 HEAD | tr '\n' ' ')

          curl -s -X POST "${{ secrets.DISCORD_WEBHOOK_URL }}" \
          -H "Content-Type: application/json" \
          -d "{
            \"embeds\": [{
              \"title\": \"üöÄ RoNexus ‚Äî New Deploy\",
              \"color\": 940299,
              \"fields\": [
                { \"name\": \"üìù Update\", \"value\": \"\`\`\`$COMMIT_MSG\`\`\`\" },
                { \"name\": \"üë§ By\", \"value\": \"$AUTHOR\", \"inline\": true },
                { \"name\": \"üîñ Commit\", \"value\": \"\`$HASH\`\", \"inline\": true },
                { \"name\": \"üìÅ Files\", \"value\": \"\`$FILES\`\" }
              ],
              \"footer\": { \"text\": \"ronexus.org\" },
              \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"
            }]
          }"
